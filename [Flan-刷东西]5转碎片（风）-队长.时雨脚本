// 5转碎片 - 队长版
// 请配合【5转碎片-队员】脚本
// 外挂面板上探测周围东西最长距离为11格

nPeople = 信息输入("队伍人数","输入队伍成员数(0~5)",人物详细信息(37))
isSaleStone = 信息提示("包满是否出售魔石","36")
isCommonNurse = 信息提示("是否不去普通护士？", 36) != 5
curPet = 当前出战宠物()
humanBackHP = 人物详细信息(3)*0.5
humanBackMP = 人物详细信息(5)*0.05
petBackHP = 宠物详细信息(curPet,3)*0.4
petBackMP = 宠物详细信息(curPet,5)*0.05
isAutoSettings = 信息提示("是否以下列数值作为设置{ " $ "人回补血:" $ humanBackHP $ ", " $ "人回补魔:" $ humanBackMP $ ", " $ "宠回补血:" $ petBackHP $ ", " $ "宠回补魔:" $ petBackMP $ " }","36")
如果(isAutoSettings != 5)
	humanBackHP = 信息输入("人回补血值","人回补血值",humanBackHP)
	humanBackMP = 信息输入("人回补魔值","人回补魔值",humanBackMP)
	petBackHP = 信息输入("宠回补血值","宠回补血值",petBackHP)
	petBackMP = 信息输入("宠回补魔值","宠回补魔值",petBackMP)
如果尾()

isBack = 0
// 战斗地回去坐标
battlePlaceX = 0
battlePlaceY = 0

//是否自动寻找洞口
isGetHoleCoord = 信息提示("是否自动探测洞口，若选否，则需要自己修改坐标: holeX,holeY", 36) != 5
holeX = 0
holeY = 0

如果(isGetHoleCoord != 0)
	holeCoordStr = 信息输入("x,y","输入洞口坐标，注意逗号是半角", "0,0")
	分割文本(holeCoord, holeCoordStr, ",")
	holeX = holeCoord.1
	holeY = holeCoord.2
如果尾()

//行进路径中继坐标（如果不设置，某些地方可能会卡住）
定义数组(pathCoords, 0)
加入成员(pathCoords, "480,255")
countPathCoords = 取成员数(pathCoords)

//洞窟范围(332~359,508~529)
分割文本(holeRangeX, "384~408", "~")
分割文本(holeRangeY, "194~245", "~")

//检测点
定义数组(testCoords, 0)
加入成员(testCoords, "398,240")
加入成员(testCoords, "398,233")
加入成员(testCoords, "398,226")
加入成员(testCoords, "396,220")
加入成员(testCoords, "396,213")
加入成员(testCoords, "396,206")
加入成员(testCoords, "396,199")
加入成员(testCoords, "403,206")

//排除坐标
excludeCoord = "0,0"

//自动移动一格
定义数组(deltaX,0)
定义数组(deltaY,0)

加入成员(deltaX,0)
加入成员(deltaY,-1)

加入成员(deltaX,1)
加入成员(deltaY,0)

加入成员(deltaX,0)
加入成员(deltaY,1)

加入成员(deltaX,-1)
加入成员(deltaY,0)

循环( 1 )

	循环(人物详细信息(34) == "艾尔莎岛")
		如果( isBack == 0 )
			移动到(140,105)
			循环(人物详细信息(34) != "里谢里雅堡")
				对话NPC(1,7,"","","","")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "里谢里雅堡")
		如果(isBack == 0)
			自动寻路(41,98)
			循环(人物详细信息(34) != "法兰城")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "法兰城")
		如果(isBack == 0)
			自动寻路(153,241)
			循环(人物详细信息(34) != "芙蕾雅")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "芙蕾雅")
		如果(isBack == 0)
			自动寻路(513,282)
			循环(人物详细信息(34) != "曙光骑士团营地")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "曙光骑士团营地")
		如果(isBack == 0)
			移动到(26,59)
			移动到(35,50)
			移动到(52,50)
			自动寻路(55,47)
			循环(人物详细信息(34) != "辛希亚探索指挥部\\z0")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "辛希亚探索指挥部\\z0")
		如果(isBack == 0)
			退出队伍()
			自动寻路(7,4)
			curX = 人物详细信息(35)
			curY = 人物详细信息(36)
			循环(curX != 91 || curY != 6)
				curX = 人物详细信息(35)
				curY = 人物详细信息(36)
			循环尾()
			自动寻路(95,9)
			循环(curX != 19 || curY != 28)
				curX = 人物详细信息(35)
				curY = 人物详细信息(36)
			循环尾()
			自动寻路(8,22)
			人物转身(7)
			循环(人物详细信息(34) != "圣骑士营地")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "圣骑士营地")
		如果(isBack == 0)
			如果(人物详细信息(37) < nPeople )
				自动寻路(97,86)
				切图(7)
				循环(人物详细信息(37) < nPeople)
					等待(1000)
				循环尾()
			如果尾()

			自动寻路(36,87)
			循环(人物详细信息(34) != "肯吉罗岛")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
			如果(isSaleStone == 5)
				如果(获取物品数量("魔石","") > 0)
					自动寻路(87,72)
					循环(人物详细信息(34) != "工房\\z0")
						等待(100)
					循环尾()
				如果尾()
				如果(获取物品数量("魔石","") < 1)
					自动寻路(95,72)
					循环(人物详细信息(34) != "医院\\z0")
						等待(100)
					循环尾()
				如果尾()
			如果尾()
			如果(isSaleStone != 5)
				自动寻路(95,72)
				循环(人物详细信息(34) != "医院\\z0")
					等待(100)
				循环尾()
			如果尾()
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "工房\\z0")
		如果( isBack == 0 )
			自动寻路(30,37)
			循环(人物详细信息(34) != "圣骑士营地")
				等待(100)
			循环尾()
		如果尾()
		如果( isBack != 0 )
			自动寻路(20,22)
			移动到(20,23)
			移动到(20,22)
			移动到(20,23)
			移动到(20,22)
			移动到(20,23)
			移动到(20,22)
			
			curX = 人物详细信息("35")
			curY = 人物详细信息("36")
			如果(curX == 20 && curY == 23)
				出售物品(2,"魔石|锹型虫的卡片|虎头蜂的卡片|绿色口臭鬼的卡片|水晶怪的卡片|水蜘蛛的卡片|狮鹫的卡片")
			如果尾()
			如果(curX == 20 && curY == 22)
				出售物品(3,"魔石|锹型虫的卡片|虎头蜂的卡片|绿色口臭鬼的卡片|水晶怪的卡片|水蜘蛛的卡片|狮鹫的卡片")
			如果尾()
			等待(12000)
			自动寻路(30,37)
			循环(人物详细信息(34) != "圣骑士营地")
				等待(100)
			循环尾()
		如果尾()

	循环尾()

	循环(人物详细信息(34) == "肯吉罗岛")
		如果( isBack == 0 )
			如果(isGetHoleCoord == 0)
				//begin 走到中继坐标
				k = 1
				循环( k <= countPathCoords )
					分割文本(pathCoord, pathCoords.k, ",")
					自动寻路(pathCoord.1, pathCoord.2)
					k = k + 1
				循环尾()
				//end 走到中继坐标

				i = 1
				count = 取成员数(testCoords)
				发送聊天( "检测点数目:" $ count, 6, 1 )
				循环( i <= count && isGetHoleCoord == 0)
					分割文本(testCoord, testCoords.i, ",")
					发送聊天( "监测点:(" $ testCoord.1 $ "," $ testCoord.2 $ ")", 6, 1 )
					自动寻路(testCoord.1, testCoord.2)
					等待(3000)
					//寻路过程中进入到了目标洞
					如果(寻找文本(人物详细信息(34), "隐秘之洞地下1层") != -1)
						// begin 向能动方向移动一格
						curX = 人物详细信息(35)
						curY = 人物详细信息(36)
						j = 1
						循环(人物详细信息(35) == curX && 人物详细信息(36) == curY && j <= 4)
							自动寻路(curX + deltaX.j, curY + deltaY.j)
							j = j + 1
						循环尾()
						// end 向能动方向移动一格
						// 出洞
						自动寻路(curX,curY)

						等待(3000)
						如果(人物详细信息(34) == "肯吉罗岛")
							holeX = 人物详细信息(35)
							holeY = 人物详细信息(36)
							发送聊天( "碎片洞:(" $ holeX $ "," $ holeY $ ")", 0, 1 )
							isGetHoleCoord = 1

							// begin 向能动方向移动一格
							curX = 人物详细信息(35)
							curY = 人物详细信息(36)
							j = 1
							循环(人物详细信息(35) == curX && 人物详细信息(36) == curY && j <= 4)
								自动寻路(curX + deltaX.j, curY + deltaY.j)
								j = j + 1
							循环尾()
							// end 向能动方向移动一格
						如果尾()
					如果尾()

					//寻路过程中进入到了意外洞
					如果(人物详细信息(34) == "未来之塔入口第1层\\z12\\z0")
						// begin 向能动方向移动一格
						curX = 人物详细信息(35)
						curY = 人物详细信息(36)
						j = 1
						循环(人物详细信息(35) == curX && 人物详细信息(36) == curY && j <= 4)
							自动寻路(curX + deltaX.j, curY + deltaY.j)
							j = j + 1
						循环尾()
						// end 向能动方向移动一格
						// 出洞
						自动寻路(curX,curY)
						等待(3000)
						如果(人物详细信息(34) == "肯吉罗岛")
							excludeCoord = 人物详细信息(35) $ "," $ 人物详细信息(36)
							发送聊天( "未来之塔入口:(" $ excludeCoord $ ")", 0, 1 )
						如果尾()
					如果尾()

					getCoordStr = 获取周围信息("临时过图点", "NPC")
					如果(getCoordStr != "")
						分割文本(getCoord, getCoordStr, "|")
						targetCoord = getCoord.2 $ "," $ getCoord.3
						如果(getCoord.2 >= holeRangeX.1 && getCoord.2 <= holeRangeX.2 && getCoord.3 >= holeRangeY.1 && getCoord.3 <= holeRangeY.2 && targetCoord != excludeCoord)

							发送聊天( getCoord.1 $ ":(" $ getCoord.2 $ "," $ getCoord.3 $ ")", 1, 1 )

							自动寻路(getCoord.2, getCoord.3)
							等待(3000)
							如果(寻找文本(人物详细信息(34), "隐秘之洞地下1层") != -1)
								// begin 向能动方向移动一格
								curX = 人物详细信息(35)
								curY = 人物详细信息(36)
								j = 1
								循环(人物详细信息(35) == curX && 人物详细信息(36) == curY && j <= 4)
									自动寻路(curX + deltaX.j, curY + deltaY.j)
									j = j + 1
								循环尾()
								// end 向能动方向移动一格
								// 出洞
								自动寻路(curX,curY)

								等待(3000)
								如果(人物详细信息(34) == "肯吉罗岛")
									holeX = 人物详细信息(35)
									holeY = 人物详细信息(36)
									发送聊天( "碎片洞:(" $ holeX $ "," $ holeY $ ")", 0, 1 )
									isGetHoleCoord = 1

									// begin 向能动方向移动一格
									curX = 人物详细信息(35)
									curY = 人物详细信息(36)
									j = 1
									循环(人物详细信息(35) == curX && 人物详细信息(36) == curY && j <= 4)
										自动寻路(curX + deltaX.j, curY + deltaY.j)
										j = j + 1
									循环尾()
									// end 向能动方向移动一格
								如果尾()
							如果尾()

							如果(人物详细信息(34) == "未来之塔入口第1层\\z12\\z0")
								// begin 向能动方向移动一格
								curX = 人物详细信息(35)
								curY = 人物详细信息(36)
								j = 1
								循环(人物详细信息(35) == curX && 人物详细信息(36) == curY && j <= 4)
									自动寻路(curX + deltaX.j, curY + deltaY.j)
									j = j + 1
								循环尾()
								// end 向能动方向移动一格
								// 出洞
								自动寻路(curX,curY)
								等待(3000)
								如果(人物详细信息(34) == "肯吉罗岛")
									excludeCoord = 人物详细信息(35) $ "," $ 人物详细信息(36)
									发送聊天( "未来之塔入口:(" $ excludeCoord $ ")", 0, 1 )
								如果尾()
							如果尾()
							
						如果尾()
					如果尾()

					i = i + 1
				循环尾()

			如果尾()

			如果(isGetHoleCoord != 0)
				发送聊天( "目标洞入口:(" $ holeX $ "," $ holeY $ ")", 4, 1 )
				自动寻路(holeX, holeY)
				tryCount = 0
				循环( tryCount < 10 && 寻找文本(人物详细信息(34), "隐秘之洞地下1层") == -1)
					等待(1000)
					tryCount = tryCount + 1
				循环尾()
				
				如果( tryCount == 10 )
					isGetHoleCoord = 0
					excludeCoord = "0,0"
					发送聊天( "重新寻找洞口!", 6, 1 )
				如果尾()
			如果尾()

		如果尾()

		如果(isBack != 0)
			//begin 逆走中继坐标
			k = countPathCoords
			循环( k >= 1 )
				分割文本(pathCoord, pathCoords.k, ",")
				自动寻路(pathCoord.1, pathCoord.2)
				k = k - 1
			循环尾()
			//end 逆走中继坐标

			自动寻路(551,332)
			循环(人物详细信息(34) != "圣骑士营地")
				等待(100)
			循环尾()
		如果尾()
	循环尾()

	循环(寻找文本(人物详细信息(34), "隐秘之洞地下1层") != -1)
		如果( isBack == 0 )
			battlePlaceX = 人物详细信息(35)
			battlePlaceY = 人物详细信息(36)

			// 自动遇敌开始了
			自动遇敌(1,3,170)

			循环( 获取信息记录("<back>","普通") != "" )
				//等待消除全部<back>
				等待(100)
			循环尾()

			循环(isBack == 0)
				等待战斗结束()
				curPet = 当前出战宠物()
				如果(人物详细信息(2) < humanBackHP)
					isBack = 1
					跳出循环()
				如果尾()
				如果(人物详细信息(4) < humanBackMP)
					isBack = 1
					跳出循环()
				如果尾()
				如果(宠物详细信息(curPet,2) < petBackHP)
					isBack = 1
					跳出循环()
				如果尾()
				如果(宠物详细信息(curPet,4) < petBackMP)
					isBack = 1
					跳出循环()
				如果尾()
				如果( 获取信息记录("<back>","普通") != "" )
					isBack = 1
					跳出循环()
				如果尾()
				如果( 获取信息记录("被不可思议的力量送出了","系统") != "" )
					isGetHoleCoord = 0
					excludeCoord = "0,0"
					发送聊天( "重新寻找洞口!", 6, 1 )
					跳出循环()
				如果尾()
			循环尾()
			自动遇敌(0)
			等待(3000)
		如果尾()

		如果(isBack != 0)
			移动到(battlePlaceX,battlePlaceY)
			循环(人物详细信息(34) != "肯吉罗岛")
				等待(100)
			循环尾()
		如果尾()
	循环尾()

	循环(人物详细信息(34) == "医院\\z0")
		如果(isBack == 0)
			自动寻路(5,20)
			移动到(0,20)
			循环(人物详细信息(34) != "圣骑士营地")
				等待(100)
			循环尾()
		如果尾()

		如果(isBack != 0)
			移动到(5,20)
			如果(isCommonNurse == 0)
				移动到(9,16)
				移动到(9,10)
				移动到(9,12)
				等待(2000)
				护士恢复(1)
			如果尾()
			如果(isCommonNurse != 0)
				自动寻路(17,17)
				//移动到(17,13)
				移动到(17,15)
				//移动到(17,13)
				等待(2000)
				护士恢复(1)
			如果尾()
			isBack = 0
			循环( 获取信息记录("<back>","普通") != "" )
				//等待消除全部<back>
				等待(100)
			循环尾()
		如果尾()
	循环尾()

循环尾()









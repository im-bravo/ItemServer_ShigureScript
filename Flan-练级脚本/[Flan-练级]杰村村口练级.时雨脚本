// 【Flan脚本】杰诺瓦镇村口练级

// 遇敌模式(模式,间隔)
分割文本(G_EnemyMeetMode, "1,170", ",")
// 练级选择点(地点描述串|默认选择)
分割文本(G_MonsterPlaceChoice,"0：村外","|")
// 单人or多人
G_IsSingle = 1
// 卖的物品 item1|item2
G_SaleItems = "魔石|蔓陀罗草的卡片|火焰哥布林的卡片|卡片？"
// 堆叠物品 item1|20,item2|3
G_StackItems = "曼陀罗草的皮|5"
// 丢弃物品 item1,item2
G_ThrowItems = "布？"

// 如果有堆叠物品，则加入自动堆叠列表
如果(G_StackItems != "")
    自动叠加道具(1)
    分割文本(stackItemsArr,G_StackItems,",")
    nArr = 取成员数(stackItemsArr)
    i = 1
    循环(i <= nArr)
        自动叠加道具(2,stackItemsArr.i)
        i = i + 1
    循环尾()
如果尾()

// 如果有需要丢弃物品，则加入自动丢弃列表
如果(G_ThrowItems != "")
    自动丢弃道具(1)
    分割文本(throwItemsArr,G_ThrowItems,",")
    nArr = 取成员数(throwItemsArr)
    i = 1
    循环(i <= nArr)
        自动丢弃道具(1,throwItemsArr.i)
        i = i + 1
    循环尾()
如果尾()

// 是单人还是多人，并取得队伍人数和队长姓名
如果(G_IsSingle == 1)
    G_PeopleCount = 人物详细信息(37)
    G_TeamMasterName = 人物详细信息(1)
否则()
    获取队长信息(2)
    // 如果人数大于1说明有队伍，则取得队长名字
    如果(人物详细信息(37) > 1)
        G_PeopleCount = 人物详细信息(37)
        G_TeamMasterName = 获取队长信息(1)
    如果尾()

    // 单人队伍从面板获取人数，从面板获取是否队长
    如果(人物详细信息(37) < 2)
        G_PeopleCount = 面板设置信息(7)
        如果(获取队长信息(0) == 5)
            G_TeamMasterName = 信息输入("队长名字","输入队长名字",人物详细信息(1))
        否则()
            G_TeamMasterName = 信息输入("队长名字","输入队长名字",获取队长信息(1))
        如果尾()
    如果尾()
如果尾()

// 如果是队长
如果(人物详细信息(1) == G_TeamMasterName)
    // 是否卖石
    G_IsSaleStone = 信息提示("包满是否出售魔石",36) == 5
    // 是否普通护士
    G_IsCommonNurse = 信息提示("是否去资深护士（即是否不去普通护士）？",36) != 5
    // 练级点
    如果(取成员数(G_MonsterPlaceChoice) > 1)
        G_MonsterPlace = 信息输入(G_MonsterPlaceChoice.1,"选择练级地点",G_MonsterPlaceChoice.2)
    如果尾()
    发送聊天("我是队长:[" $ G_TeamMasterName $ "]，队员:[" $ G_PeopleCount $ "]...",4,1)
否则()
    发送聊天("队长名字:[" $ G_TeamMasterName $ "]，队员:[" $ G_PeopleCount $ "]...",2,1)
如果尾()

// 执行动作【练级，回补】
curAction = "练级"
如果(人物详细信息(34) == "杰诺瓦镇" || 人物详细信息(34) == "莎莲娜")
    curAction = 信息输入("执行动作【练级，回补】","执行动作","练级")
如果尾()

battleCount = 0

循环( 1 )
    循环(人物详细信息(34) == "艾尔莎岛")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(flag == 0)
            移动到(140,105)
            循环(人物详细信息(34) != "里谢里雅堡")
                对话NPC(1,7,"","","","")
                等待(100)
            循环尾()
        如果尾()

    循环尾()

    循环(人物详细信息(34) == "里谢里雅堡")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "练级")
            flag = 1
            自动寻路(41,50)
            循环(人物详细信息(34) != "里谢里雅堡\S1楼\\z0")
                等待(100)
            循环尾()
            
        如果尾()

        如果(curAction == "回补")
            flag = 3
            curPet = 当前出战宠物()
            如果(人物详细信息(2) < 人物详细信息(3) || 人物详细信息(4) < 人物详细信息(5) || 宠物详细信息(curPet,2) < 宠物详细信息(curPet,3) || 宠物详细信息(curPet,4) < 宠物详细信息(curPet,5))
                自动寻路(34,89)
                护士恢复(1)
            如果尾()
            curAction = "练级"
            
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "里谢里雅堡\S1楼\\z0")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "练级")
            flag = 1
            自动寻路(45,20)
            循环(人物详细信息(34) != "启程之间\\z0")
                等待(100)
            循环尾()
            
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "启程之间\\z0")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "练级")
            flag = 1
            自动寻路(15,5)
            循环(人物详细信息(34) != "杰诺瓦镇的传送点\\z0")
                对话NPC(1,7,"","","","")
                等待(100)
            循环尾()
            
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "杰诺瓦镇的传送点\\z0")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "练级")
            flag = 1
            自动寻路(14,6)
            循环(人物详细信息(34) != "村长的家\\z0")
                等待(100)
            循环尾()
            
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "村长的家\\z0")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "练级")
            flag = 1
            自动寻路(1,9)
            循环(人物详细信息(34) != "杰诺瓦镇")
                等待(100)
            循环尾()
            
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "杰诺瓦镇")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "练级")
            flag = 1
            自动寻路(24,40)
            循环(人物详细信息(34) != "莎莲娜")
                等待(100)
            循环尾()
            
        如果尾()

        如果(curAction == "回补")
            flag = 2
            //有魔石
            isHasStone = 获取物品数量("魔石","") > 0
            如果(isHasStone != 0)
                自动寻路(43,23)
                循环(人物详细信息(34) != "杂货店\\z0")
                    等待(100)
                循环尾()
            如果尾()
            //没魔石
            如果(isHasStone == 0)
                自动寻路(44,33)
                循环(人物详细信息(34) != "医院\\z0")
                    等待(100)
                循环尾()
            如果尾()
            
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "莎莲娜")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "练级")
            flag = 1
            移动到(214,456)

            // 自动遇敌开始了
            自动遇敌(1,G_EnemyMeetMode.1,G_EnemyMeetMode.2)
            循环(是否需要回补() == 0 && (G_IsSaleStone == 0 || 人物详细信息(33) < 20))
                等待(1000)
                等待战斗结束()
            循环尾()
            自动遇敌(0)
            curAction = "回补"
            等待(1000)
        如果尾()

        如果(curAction == "回补")
            flag = 2
            自动寻路(217,456)
            循环(人物详细信息(34) != "杰诺瓦镇")
                等待(100)
            循环尾()
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "杂货店\\z0")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "回补")
            flag = 1
            移动到(11,12)
            出售物品(2,G_SaleItems)
            //判断是否不需要回补
            如果(是否需要回补() == 0)
                curAction = "练级"
            如果尾()

            自动寻路(9,16)
            循环(人物详细信息(34) != "杰诺瓦镇")
                等待(100)
            循环尾()
            
        如果尾()

        如果(curAction == "练级")
            flag = 2
            自动寻路(9,16)
            循环(人物详细信息(34) != "杰诺瓦镇")
                等待(100)
            循环尾()
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "医院\\z0")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0
        如果(curAction == "回补")
            flag = 1
            移动到(15,9)
            护士恢复(0)
            curAction = "练级"
            等待(1000)
        如果尾()

        如果(curAction == "练级")
            flag = 2
            自动寻路(1,9)
            循环(人物详细信息(34) != "杰诺瓦镇")
                等待(100)
            循环尾()
        如果尾()

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

    循环(人物详细信息(34) == "法兰城")
        //发送聊天("在[" $ 人物详细信息(34) $ "]执行[" $ curAction $ "]...", 4, 1)
        flag = 0

        如果(flag == 0)
            发送聊天("动作[" $ curAction $ "]在[" $ 人物详细信息(34) $ "]是未定义的...", 6, 1)
        如果尾()
    循环尾()

循环尾()









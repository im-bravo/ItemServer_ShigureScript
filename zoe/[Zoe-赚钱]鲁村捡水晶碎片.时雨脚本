//鲁村捡碎片脚本，支持新城/哥城启动，脚本制作@小巫师

isBack = 0

humanBackHP = 人物详细信息(3)*0.5
humanBackMP = 人物详细信息(5)*0.05
petBackHP = 宠物详细信息(curPet,3)*0.4
petBackMP = 宠物详细信息(curPet,5)*0.05
isAutoSettings = 信息提示("是否以下列数值作为设置{ " $ "人回补血:" $ humanBackHP $ ", " $ "人回补魔:" $ humanBackMP $ ", " $ "宠回补血:" $ petBackHP $ ", " $ "宠回补魔:" $ petBackMP $ " }","36")
如果(isAutoSettings != 5)
	humanBackHP = 信息输入("人回补血值","人回补血值",humanBackHP)
	humanBackMP = 信息输入("人回补魔值","人回补魔值",humanBackMP)
	petBackHP = 信息输入("宠回补血值","宠回补血值",petBackHP)
	petBackMP = 信息输入("宠回补魔值","宠回补魔值",petBackMP)
如果尾()

登出回城()
等待("3000")

//去哥拉尔
如果(人物详细信息("34") !="哥拉尔镇")
	等待("1000")
	循环(人物详细信息("34") !="法兰城" && 人物详细信息("34") !="艾尔莎岛")
		登出回城()
		等待("3000")
	循环尾()
	如果(人物详细信息("34") =="法兰城")
		调用脚本模块("法兰到启程之间")
	如果尾()
	如果(人物详细信息("34") =="艾尔莎岛")
		调用脚本模块("新城到启程之间")
	如果尾()
	自动寻路("43","32")
	等待("1000")
	对话NPC("2","7")
	循环(人物详细信息("34") !="伊尔村的传送点\\z0")
		等待("1000")
	循环尾()
	自动寻路("12","17")
	循环(人物详细信息("34") !="村长的家\\z0")
		等待("1000")
	循环尾()
	自动寻路("6","13")
	循环(人物详细信息("34") !="伊尔村")
		等待("1000")
	循环尾()
	自动寻路("58","71")
	等待("1000")
	对话NPC("2","7")
	循环(人物详细信息("34") !="伊尔")
		等待("1000")
	循环尾()
	自动寻路("30","21")
	循环(人物详细信息("34") !="港湾管理处\\z0")
		等待("1000")
	循环尾()
	自动寻路("25","25")
	等待("1000")
	对话NPC("0","7")
	循环(人物详细信息("34") !="往哥拉尔栈桥")
		等待("1000")
	循环尾()
	自动寻路("51","50")
	循环(人物详细信息("34") !="铁达尼号\\z0")
		对话NPC("2","7")	
		等待("30000")
	循环尾()
	循环(获取信息记录("本船已到达了哥拉尔港。","普通") != "船员")
		等待("30000")
	循环尾()
	循环(人物详细信息("34") !="往伊尔栈桥")
		对话NPC("2","7")	
		等待("3000")
	循环尾()
	自动寻路("84","55")
	循环(人物详细信息("34") !="哥拉尔镇\S港湾管理处\\z0")
		对话NPC("0","7")	
		等待("3000")
	循环尾()
	自动寻路("14","15")
	循环(人物详细信息("34") !="哥拉尔镇")
		等待("1000")
	循环尾()
	自动寻路("118","214")
	循环(人物详细信息("35") !="120" || 人物详细信息("36") !="107")
		人物转身("2")
		等待("2000")
	循环尾()
	自动寻路("118","106")
如果尾()


循环("1" == "1")
	如果(人物详细信息("34") == "哥拉尔镇")
		如果(人物详细信息("28") > "990000")
			如果(人物详细信息("36") > "200")
				自动寻路("118","214")
				循环(人物详细信息("34") != "哥拉尔镇" || 人物详细信息("35") != "120" || 人物详细信息("36") != "107")
					人物转身("2")
					等待("1000")
				循环尾()
			如果尾()
			自动寻路("167","66")
			循环(人物详细信息("34") != "银行\\z0")
				等待("200")
			循环尾()
			自动寻路("25","10")
			循环(打开银行("2","") != "1")
				等待("200")
			循环尾()
			存取物品("存钱","金钱","900000","","")
			等待("2000")
			循环(人物详细信息("28") > "990000")
				发送聊天("银行钱库已满~~是时候提款了！！！","5","0")
				等待("60000")
			循环尾()
			自动寻路("11","12")
			循环(人物详细信息("34") != "哥拉尔镇")
				等待("200")
			循环尾()
		如果尾()
		如果(人物详细信息("2") < 人物详细信息("3") || 人物详细信息("4") < 人物详细信息("5") || 宠物详细信息(当前出战宠物(),"2") < 宠物详细信息(当前出战宠物(),"3") || 宠物详细信息(当前出战宠物(),"4") < 宠物详细信息(当前出战宠物(),"5"))
			如果(人物详细信息("36") > "200")
				自动寻路("118","214")
				循环(人物详细信息("34") != "哥拉尔镇" || 人物详细信息("35") != "120" || 人物详细信息("36") != "107")
					人物转身("2")
					等待("1000")
				循环尾()
			如果尾()
			自动寻路("165","91")
			循环(人物详细信息("34") != "医院\\z0")
				等待("200")
			循环尾()
			移动到("20","26")
			移动到("29","26")
			护士恢复("2")
			移动到("20","26")
			移动到("9","23")
			循环(人物详细信息("34") != "哥拉尔镇")
				等待("200")
			循环尾()
		如果尾()
		如果(人物详细信息("36") > "200")
			自动寻路("118","214")
			循环(人物详细信息("34") != "哥拉尔镇" || 人物详细信息("35") != "120" || 人物详细信息("36") != "107")
				人物转身("2")
				等待("1000")
			循环尾()
		如果尾()
		自动寻路("176","105")
		循环(人物详细信息("34") != "库鲁克斯岛")
			等待("200")
		循环尾()
	如果尾()
	如果(人物详细信息("34") == "库鲁克斯岛")
		如果(人物详细信息("36") < "527")
			自动寻路("476","525")
			循环(人物详细信息("34") != "库鲁克斯岛" || 人物详细信息("35") != "476" || 人物详细信息("36") != "528")
				对话NPC("3","7")
				等待("200")
			循环尾()
		如果尾()
		自动寻路("322","883")
		循环(人物详细信息("34") != "鲁米那斯")
			等待("200")
		循环尾()
	如果尾()
	
	//剥离
循环(1)
	//补给卖石
	循环(人物详细信息(34) == "鲁米那斯")
		如果(isBack != 0)
			移动到("80","40")
			移动到("87","35")
			循环(人物详细信息("34") != "医院\\z0")
				等待("200")
			循环尾()
			移动到("18","15")
			护士恢复("4")
			isBack = 0
			//汇报碎片数量
			//发送聊天("地的水晶碎片: " $ 获取物品数量("地的水晶碎片",""),"1","1")
			//发送聊天("水的水晶碎片: " $ 获取物品数量("水的水晶碎片",""),"1","1")
			//发送聊天("火的水晶碎片: " $ 获取物品数量("火的水晶碎片",""),"1","1")
			//发送聊天("风的水晶碎片: " $ 获取物品数量("风的水晶碎片",""),"1","1")
			发送聊天("水晶碎片总数: " $ 获取物品数量("地的水晶碎片","")+获取物品数量("水的水晶碎片","")+获取物品数量("火的水晶碎片","")+获取物品数量("风的水晶碎片",""),"1","1")
			移动到("4","14")
			循环(人物详细信息("34") != "鲁米那斯")
				等待("200")
			循环尾()
		如果尾()
		如果(人物详细信息("33") > "6")
			移动到("80","40")
			移动到("88","51")
			循环(人物详细信息("34") != "杂货店\\z0")
				等待("200")
			循环尾()
			移动到("11","12")
			出售物品("2","魔石|口袋龙的卡片|地狱看门犬的卡片|卡片？")
			移动到("4","13")
			循环(人物详细信息("34") != "鲁米那斯")
				等待("200")
			循环尾()
		如果尾()
		移动到("73","38")
		自动寻路("60","29")
		循环(人物详细信息("34") != "库鲁克斯岛")
			等待("200")
		循环尾()
		移动到("308","883")
		等待("500")
	循环尾()

	//外出工作
	循环(人物详细信息(34) == "库鲁克斯岛")
		如果(isBack == 0)
			//开始捡碎片

			循环( 获取信息记录("发生错误，目标地点无法到达，自动寻路结束！","普通") != "" )
				//等待消除全部错误信息
				等待(100)
			循环尾()

			//鲁村没有地碎片
			//分割文本(Project, 获取周围信息("地的水晶碎片","物品"), "|")
			//ProjectX = Project.2
			//ProjectY = Project.3
			//如果(ProjectX != "")
			//	自动寻路(ProjectX-1, ProjectY)
			//	拾取物品("2")
			//如果尾()

			分割文本(ProjectA, 获取周围信息("水的水晶碎片","物品"), "|")
			ProjectAX = ProjectA.2
			ProjectAY = ProjectA.3
			如果(ProjectAX = "")
				ProjectAX = 0
				ProjectAY = 0
			如果尾()
			分割文本(ProjectB, 获取周围信息("火的水晶碎片","物品"), "|")
			ProjectBX = ProjectB.2
			ProjectBY = ProjectB.3
			如果(ProjectBX = "")
				ProjectBX = 0
				ProjectBY = 0
			如果尾()
			分割文本(ProjectC, 获取周围信息("风的水晶碎片","物品"), "|")
			ProjectCX = ProjectC.2
			ProjectCY = ProjectC.3
			如果(ProjectCX = "")
				ProjectCX = 0
				ProjectCY = 0
			如果尾()
		
			PlayerX = 人物详细信息(35)
			PlayerY = 人物详细信息(36)

			DistanceA = (ProjectAX-PlayerX)*(ProjectAX-PlayerX)+(ProjectAY-PlayerY)*(ProjectAY-PlayerY)
			DistanceB = (ProjectBX-PlayerX)*(ProjectBX-PlayerX)+(ProjectBY-PlayerY)*(ProjectBY-PlayerY)
			DistanceC = (ProjectCX-PlayerX)*(ProjectCX-PlayerX)+(ProjectCY-PlayerY)*(ProjectCY-PlayerY)


			如果(DistanceA<=DistanceB)
				如果(DistancA<=DistanceC)
					自动寻路(ProjectAX-1, ProjectAY)
					拾取物品("0")
					拾取物品("1")
					拾取物品("2")
					拾取物品("3")
					拾取物品("4")
					拾取物品("5")
					拾取物品("6")
					拾取物品("7")
					丢弃物品("卡片？","0","","2")
				如果尾()
				如果(DistancA>DistanceC)
					自动寻路(ProjectCX-1, ProjectCY)
					拾取物品("0")
					拾取物品("1")
					拾取物品("2")
					拾取物品("3")
					拾取物品("4")
					拾取物品("5")
					拾取物品("6")
					拾取物品("7")
					丢弃物品("卡片？","0","","2")
				如果尾()
			如果尾()
			如果(DistanceA>DistanceB)
				如果(DistancB<=DistanceC)
					自动寻路(ProjectBX-1, ProjectBY)
					拾取物品("0")
					拾取物品("1")
					拾取物品("2")
					拾取物品("3")
					拾取物品("4")
					拾取物品("5")
					拾取物品("6")
					拾取物品("7")
					丢弃物品("卡片？","0","","2")
				如果尾()
				如果(DistancB>DistanceC)
					自动寻路(ProjectCX-1, ProjectCY)
					拾取物品("0")
					拾取物品("1")
					拾取物品("2")
					拾取物品("3")
					拾取物品("4")
					拾取物品("5")
					拾取物品("6")
					拾取物品("7")
					丢弃物品("卡片？","0","","2")
				如果尾()
			如果尾()

			如果( 获取信息记录("发生错误，目标地点无法到达，自动寻路结束！","普通") != "" )
				自动寻路(308,883)
			如果尾()

			如果( 获取信息记录("发生错误\\c无效寻路坐标点..","普通") != "" )
				自动寻路(308,883)
			如果尾()

			如果( 获取信息记录("发生错误，目标地点无法到达，自动寻路结束！","普通") != "" )
				自动寻路(306,867)
			如果尾()

			如果( 获取信息记录("发生错误\\c无效寻路坐标点..","普通") != "" )
				自动寻路(306,867)
			如果尾()

			//判定回补
			curPet = 当前出战宠物()
			如果(人物详细信息(2) < humanBackHP)
				isBack = 1
				跳出循环()
			如果尾()
			如果(人物详细信息(4) < humanBackMP)
				isBack = 1
				跳出循环()
			如果尾()
			如果(宠物详细信息(curPet,2) < petBackHP)
				isBack = 1
				跳出循环()
			如果尾()
			如果(宠物详细信息(curPet,4) < petBackMP)
				isBack = 1
				跳出循环()
			如果尾()

			如果(人物详细信息(33) > 18)
				isBack = 1
				跳出循环()
			如果尾()

			//防止越走越远
			如果(人物详细信息(35) < 240)
				自动寻路(308,883)
			如果尾()
		如果尾()

		如果(isBack != 0)
			自动寻路(322,883)
			循环(人物详细信息(34) != "鲁米那斯")
				等待(100)
			循环尾()
		如果尾()
	循环尾()

循环尾()
	//剥离尾


	登出回城()
	等待("2000")
循环尾()